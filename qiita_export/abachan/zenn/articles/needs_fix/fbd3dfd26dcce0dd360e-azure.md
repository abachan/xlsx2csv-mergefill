---
title: "Azureで「誰が・いつ・どこで・何を・どう」操作したかを確認するには"
emoji: "📝"
type: "tech"
topics:[microsoft,azure,activitylog]
published: false
---

<!-- TODO: 以下を調整 -->
<!-- - Qiita画像ホスティング -->
<!-- - トピック数/形式の調整 -->
<!--   * そのままでも表示可。GitHub連携で運用する場合は画像を保存して相対パスへ書換推奨 -->
<!--   * Zennのtopicsは最大5・半角英数とハイフンのみ。候補: microsoft, azure, activitylog -->
## はじめに

システム障害が発生して根本原因を追究する際に、 **「誰が・いつ・どのリソースで・どのような操作を・どう行ったのか」** という情報を確認したいことがあるかと思います。
Azure では、この情報を **Activity Log（アクティビティログ）** から確認することができます。

## Activity Logとは何か

Activity Log は、**サブスクリプション内のリソースに対して、外部（管理プレーン／コントロールプレーン）から行われた操作の記録** です。
具体的には以下のような、リソースの状態を変更する操作が記録されます。

- **誰が操作したか**（イベント開始者）
- **いつ操作したか**（タイムスタンプ）
- **どのリソースに対してか**（リソース）
- **どのような操作を行ったか**（操作名）
- **結果**（状態）

これらの情報により、リソースに対する変更履歴を正確に追跡することが可能です。

## ログの保持期間
Activity Log はデフォルトで **90 日間保持され、その後自動的に削除されます。**
#### 90日以上保持したい場合

コンプライアンス要件や長期的な監査証跡として90日以上のログが必要な場合は、外部サービスにエクスポートすることで長期保存が可能です。

- **Log Analytics ワークスペース、Event Hubs、Azure Storage** にエクスポートする
- 特に **Log Analytics ワークスペース** にエクスポートすれば、**最大12年**まで保持期間を延長できます。

## Portal上での確認方法

Activity LogはAzure Portalから簡単に確認できます。

1. Azure Portal にログイン
2. **サブスクリプション** をクリック
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3963503/0251e487-5e70-47b5-9a3d-aa5b02f6c36d.png)

3. 対象のサブスクリプションをクリック
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3963503/9e1ed426-435f-4f15-b7a0-5365790f98bb.png)

4. 左メニューの **「アクティビティログ」** を選択
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3963503/93c010f8-0e2d-46f9-b925-cacd2260fed2.png)

## 列のカスタマイズでより見やすく

初期状態のActivity Logは「操作名」「状態」「タイムスタンプ」などの基本的な列のみが表示されています。
しかし、**「列の編集」** 機能を使うことで、調査に必要な情報を一覧に追加でき、格段に視認性が向上します。
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3963503/8e8615a0-cddf-4622-8993-f6770fdd18fe.png)



これにより、**「誰が・いつ・どこで・何を・どう操作し、その結果どうなったか」** を一目で把握でき、障害調査やセキュリティ監査の効率が大幅にアップします。
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3963503/a1497d9c-6a2b-40ab-bce4-90a488dc2363.png)


## ちょっとした願望（と現実）

アクティビティログを見ていると、せっかく履歴が残っているんだから、この操作を元に戻すボタンとか、自動で変更前の状態にロールバックする機能もあったら最高なのに…と思うかもしれません。

残念ながら、**Activity Log はあくまで監査・追跡用のログであり、ロールバック機能はありません**。
もし誤った操作によってリソースの状態が変わってしまった場合、元の状態に戻すには以下の仕組みをあらかじめ準備しておく必要があります。

- **IaC（ARM テンプレート、Terraformなど）** による構成管理
- **Azure Backup / Recovery Services Vault** によるバックアップと復元

Activity Logは「何が起きたか」を教えてくれますが、復旧は別の仕組みに頼る必要がある、と覚えておきましょう。

## まとめ

最後に、Activity Logの重要なポイントをまとめます。

- **Activity Log では「誰が・いつ・どこで・何を・どう操作したか」が確認できる**
- **デフォルトの保持期間は90日間**。長期保存にはLog Analytics等へのエクスポートが必要
- ログはあくまで証跡。復旧のためには **IaCやバックアップ** の仕組みが必須

Activity Logを正しく理解し、日々の運用やいざという時の障害調査・セキュリティ監査に役立てましょう。
