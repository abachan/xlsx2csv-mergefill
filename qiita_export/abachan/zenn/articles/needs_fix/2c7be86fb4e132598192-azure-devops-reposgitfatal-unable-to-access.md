---
title: "プロキシ環境下におけるAzure DevOps ReposへのGit接続エラー「fatal: unable to access」の原因と対処法"
emoji: "📝"
type: "tech"
topics:[git,azure,devops,repos]
published: false
---

<!-- TODO: 以下を調整 -->
<!-- - Qiita画像ホスティング -->
<!-- - トピック数/形式の調整 -->
<!--   * そのままでも表示可。GitHub連携で運用する場合は画像を保存して相対パスへ書換推奨 -->
<!--   * Zennのtopicsは最大5・半角英数とハイフンのみ。候補: git, azure, devops, repos -->
## はじめに
業務で利用するネットワーク、特にプロキシサーバーを経由する環境において、特定のツールが期待通りに動作しない問題に直面することがあります。

Webブラウザからは問題なくAzure DevOpsのWebポータルにアクセスできるにもかかわらず、Visual Studio Codeやコマンドラインから`git clone`を実行しようとすると、以下のようなエラーメッセージが表示され、処理が失敗しました。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3963503/918a9f51-f031-4ac2-92ac-3c4656ed7145.png)


本稿では、このエラーが発生する原因を解説し、具体的な解決策を提示します。

## エラーの根本原因：WebブラウザとGitクライアントの構成差異

この問題の根本原因は、WebブラウザとGitクライアントとで、ネットワークへの接続に利用されるプロキシ設定が異なる点にあります。

一般的なWebブラウザ（Microsoft Edge, Google Chromeなど）は、OSに設定されたプロキシ情報を自動的に参照し、通信を行います。そのため、ユーザーはプロキシの存在を意識することなくWebサイトを閲覧できます。

一方で、`git`コマンドを実行するGitクライアントは、OSのプロキシ設定を継承しない独立したアプリケーションとして動作します。そのため、**Gitクライアント自体にプロキシサーバー経由で通信を行うよう明示的に設定**しなければ、宛先サーバーへの接続を確立できず、タイムアウトエラーが発生します。

## 対処法：Gitクライアントへのプロキシ設定

この問題を解決するには、Gitのグローバル構成に対し、使用するプロキシサーバーの情報を設定します。
以下のコマンドをターミナル（コマンドプロンプト、PowerShell等）で実行してください。

```bash
git config --global https.proxy "http://[ユーザーID]:[パスワード]@[プロキシホスト名]:[ポート番号]"
```

このコマンドは、Gitの`https.proxy`設定に、指定したプロキシサーバーのアドレスと認証情報を記録します。`--global`オプションを付与することで、システム上のカレントユーザーが実行するすべてのGit操作にこの設定が適用されます。

### 補足事項：認証情報にドメイン名が含まれる場合

プロキシサーバーの認証において、ユーザーIDにドメイン名（例: `DOMAIN\user.name`）の指定が必要な場合、特別な設定が必要です。

コマンドラインにおいてバックスラッシュ`\`はエスケープ文字として解釈される可能性があるため、URLエンコーディング規約に従い、**`\`を`%5C`に置換して指定する**必要があります。

**ドメイン名を含む場合のコマンド例：**

```bash
git config --global https.proxy "http://[ドメイン名]%5C[ユーザーID]:[パスワード]@[プロキシホスト名]:[ポート番号]"
```

例えば、以下の情報で設定を行う場合を考えます。

  * ドメイン名: `japan`
  * ユーザーID: `yamada`
  * パスワード: `pass123`
  * プロキシホスト名: `proxy.yourcorp.com`
  * ポート番号: `8080`

この場合、実際に実行するコマンドは以下の通りです。

```bash
git config --global https.proxy "http://japan%5Cyamada:pass123@proxy.yourcorp.com:8080"
```

## 設定の確認

上記の設定を完了させた後、失敗した`git clone`コマンドを再度実行します。

```bash
git clone https://dev.azure.com/your-org/your-project/_git/your-repo
```

正しく設定が適用されていれば、Gitクライアントはプロキシサーバー経由でAzure DevOps Reposとの通信を確立し、リポジトリのクローンが正常に開始されます。

## まとめ

プロキシ環境下で発生するGitの接続エラーは、多くの場合、Gitクライアント固有のプロキシ設定が欠落していることに起因します。

**本件の要点**

  * WebブラウザとGitクライアントは、それぞれ独立したネットワーク構成を持つ。
  * プロキシ環境では、`git config --global https.proxy`コマンドによる明示的な設定が必要。
  * 認証情報のドメイン名に含まれるバックスラッシュ`\`は、`%5C`へのURLエンコードが必須。

同様の問題に直面した際の、原因特定と解決の一助となれば幸いです。
